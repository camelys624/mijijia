<!DOCTYPE html>
<!--suppress ALL -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>密集架固定列系统</title>
    <link rel="stylesheet" href="icomoon/style.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="./js/jquery-3.3.1.js"></script>
</head>
<body>
<div class="main">
    <div class="head">
        <div class="logo">
            <h1>密集架固定列系统</h1>
        </div>
        <div class="information">
            <div class="item item-T">
                <p>温度</p>
                <div class="infor">36.0</div>
            </div>
            <div class="item item-T">
                <p>湿度</p>
                <div class="infor">36.0</div>
            </div>
            <div class="item item-PM">
                <p>PM2.5</p>
                <div class="infor">36.0</div>
            </div>
        </div>
        <div class="logout">
            <img src="image/icon/logout.png" alt="退出" onclick="closeWindow()">
        </div>
        <table>
            <tr>
                <th><span class="icon-shuq"></span> 标签</th>
                <th><span class="icon-通知"></span> 公告</th>
                <th><span class="icon-in"></span> 进出人数</th>
            </tr>
            <tr>
                <td>重庆档案局某某某</td>
                <td>重庆档案局某某某诗人档案</td>
                <td>16人</td>
            </tr>
        </table>
    </div>
    <div class="container">
        <div class="c-header">
            <div class="run">
                <span class="light"></span>运行中
            </div>
            <div class="partition">
                <div class="par par-active">1区</div>
                <div class="par">2区</div>
            </div>
        </div>
        <div class="body">
            <div class="b-container" id="content">
            </div>
        </div>
        <div class="c-footer">
            <div class="lock unlock">
                <div class="icon-lock icon-unlock" id="locked" onclick="lock()">
                    <span class="circle"></span>
                </div>
                <p>解锁</p>
            </div>
            <div class="direction">
                <button class="btn prev" id="left" onclick="runLeft()"></button>
                <button class="btn next" id="right" onclick="runRight()"></button>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="f-container">
            <div class="f-items">
                <div class="fIcon">
                    <img src="./image/icon/自动开架.png" alt="自动开架">
                </div>
                <p>自动开架</p>
            </div>
            <div class="f-items">
                <div class="fIcon">
                    <img src="./image/icon/通风.png" alt="通风">
                </div>
                <p>通风</p>
            </div>
            <div class="f-items">
                <div class="fIcon">
                    <img src="./image/icon/合架.png" alt="合架">
                </div>
                <p>合架</p>
            </div>
            <div class="stop" onclick="runStop()">
                <div class="sIcon">
                    <img src="image/icon/stop.png" alt="">
                </div>
            </div>
            <div class="f-items">
                <div class="fIcon">
                    <a href="main/search.html">
                        <img src="./image/icon/搜索.png" alt="查询">
                    </a>
                </div>
                <p>查询</p>
            </div>
            <div class="f-items">
                <div class="fIcon">
                    <a href="main/history.html">
                        <img src="./image/icon/历史纪录.png" alt="历史">
                    </a>
                </div>
                <p>历史</p>
            </div>
            <div class="f-items">
                <div class="fIcon">
                    <a href="main/setting.html">
                        <img src="./image/icon/设置.png" alt="设置">
                    </a>
                </div>
                <p>系统设置</p>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="js/closeWindow.js"></script>
<script type="text/javascript">
    var end = 5;
    var head = 0;
    var leftHead, leftEnd,
        rightHead, rightEnd;
    var mid = Math.ceil(end / 2);
    let items = "";
    var status = -1;
    var flag;
    var item, index;
    let content = document.getElementById("content");
    window.onload = function () {
        for (let i = 0; i < end; i++) {
            if (status == -1) {
                if (i < 1) {
                    items += "<div class='items-fixed' id='fixed'>" + "<div class='i-head' id='i-head'>" + "00" + "</div>"
                        + "<div class='i-body'>" + "<div class='i-window i-gWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                        + "</div>" + "</div>";
                } else if (i > 0) {
                    if (i < 10) {
                        i = "0" + i;
                    }
                    items += "<div class='items'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                        + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                        + "</div>" + "</div>";
                }
                content.innerHTML = items;
                $(".direction #left").attr("class", "btn prev disabled");
            } else if (status == 0) {
                if (mid < 10) {
                    if (i < mid) {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + "0" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else if (i === mid) {
                        items += "<div class='items-fixed r-items' id='fixed'>" + "<div class='i-head' id='i-head'>" + "0" + mid + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-gWindow'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else if (mid < i && i < 10) {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + "0" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    }
                } else {
                    if (i < 10) {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + "0" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else if (i < mid) {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else if (i === mid) {
                        items += "<div class='items-fixed r-items' id='fixed'>" + "<div class='i-head' id='i-head'>" + mid + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-gWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    } else {
                        items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                            + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                            + "</div>" + "</div>";
                    }
                }
                let width = (end + 2) * 37;
                content.style.width = width + "px";
                content.innerHTML = items;
            } else if (status == 1) {
                if (i < end - 1) {
                    if (i < 10) {
                        i = "0" + i;
                    }
                    items += "<div class='items r-items'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                        + "<div class='i-body'>" + "<div class='i-window i-nWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                        + "</div>" + "</div>";
                }
                else {
                    items += "<div class='items-fixed r-items' id='fixed'>" + "<div class='i-head' id='i-head'>" + i + "</div>"
                        + "<div class='i-body'>" + "<div class='i-window i-gWindow' id='i-window'></div>" + "<div class='i-mid'></div>"
                        + "</div>" + "</div>";
                }
                content.innerHTML = items;
                $(".direction #right").attr("class", "btn next disabled");
            } else {
                console.log("something wrong!")
            }
        }
        end = end - 2;

    };
    $(document).on("click", ".items", function () {
        item = $(this).find("#i-head").html();
        index = parseInt(item);
        if (!isNaN(item)) {
            $(".items #i-head").removeClass("i-hActive");
            $(".items #i-window").removeClass("i-wActive");
            $(this).find("#i-head").attr("class", "i-head i-hActive");
            if ($(this).find("#i-window").hasClass("i-window i-nWindow")) {
                $(this).find("#i-window").attr("class", "i-window i-nWindow i-wActive");
            } else {
                $(this).find("#i-window").attr("class", "i-window i-gWindow i-wActive");
            }
        }
        // if (status == -1) {
        //     //向右移动
        //     $(".direction #left").attr("class", "btn prev disabled");
        //     $(".direction #right").removeClass("btn next disabled");
        //     $(".direction #right").attr("class", "btn next");
        //     $(".direction #right").removeAttr("disabled");
        // } else if (status == 0) {
        //     //两侧均可移动
        //     $(".direction #left").removeClass("btn prev disabled");
        //     $(".direction #right").removeClass("btn next disabled");
        //     $(".direction #left").attr("class", "btn prev");
        //     $(".direction #right").attr("class", "btn next");
        //     $(".direction button").removeAttr("disabled");
        // } else if (status == 1) {
        //     //向左移动
        //     $(".direction #right").attr("class", "btn next disabled");
        //     $(".direction #left").removeClass("btn prev disabled");
        //     $(".direction #left").attr("class", "btn prev");
        //     $(".direction #left").removeAttr("disabled");
        // }
    });
    var locStatus = true;
    var lock = function () {
        if (!locStatus) {
            $("#locked").removeClass("icon-unlock");
            $("#locked").attr("class", "icon-lock icon-locked");
            $(".circle").animate({left: "33px"}, 100);
            $(".lock").removeClass("unlock");
            $(".lock").attr("class", "lock locked")
            $(".lock").find("p").text("锁定");
            $(".direction #left").attr("class", "btn prev disabled");
            $(".direction #right").attr("class", "btn next disabled");
            $(".direction button").attr("disabled", true);
        } else {
            $("#locked").removeClass("icon-locked");
            $("#locked").attr("class", "icon-lock icon-unlock");
            $(".circle").animate({left: "0"}, 100);
            $(".lock").removeClass("locked");
            $(".lock").attr("class", "lock unlock")
            $(".lock").find("p").text("解锁");
        }
    }
    let itemsArray = document.getElementsByClassName("items");
    let fixed;
    let backtracking, _backtracking;
    if (status == -1) {
        fixed = 0;
    } else if (status == 0) {
        fixed = mid;
    } else {
        fixed = 0;
    }
    leftHead = head;
    leftEnd = mid;
    rightHead = mid;
    rightEnd = end;
    var lInterval, rInterval;
    var left = function () {
        if (fixed == mid) {
            if (index < mid) {
                $(itemsArray[leftHead]).animate({left: "0"}, 5000);
                lInterval = setInterval(function () {
                    if (leftHead < flag) {
                        $(itemsArray[leftHead + 1]).animate({left: "0"}, 5000);
                        leftHead++;
                        leftEnd = leftHead;
                    }
                }, 1500);
                console.log("runLeft-L:", leftHead, leftEnd);
            } else {
                $(itemsArray[rightHead - 1]).animate({left: "37px"}, 5000);
                lInterval = setInterval(function () {
                    if (rightHead < flag) {
                        $(itemsArray[rightHead]).animate({left: "37px"}, 5000);
                        rightHead++;
                        rightEnd = rightHead;
                    }
                }, 1500);
                console.log("runLeft-R:", rightHead, rightEnd);
            }
        } else {
            $(itemsArray[head - 1]).animate({left: "0"}, 5000);
            lInterval = setInterval(function () {
                if (head < flag) {
                    $(itemsArray[head]).animate({left: "0"}, 5000);
                    head++;
                    end = head - 1;
                    console.log("head:",head,"end:",end);
                }
            }, 1500);
        }
        flag = index;
    }

    var right = function () {
        if (fixed == mid) {
            if (index < mid) {
                $(itemsArray[leftEnd]).animate({left: "38px"}, 5000);
                rInterval = setInterval(function () {
                    if (flag < leftEnd) {
                        $(itemsArray[leftEnd - 1]).animate({left: "38px"}, 5000);
                        leftEnd--;
                        leftHead = leftEnd;
                    }
                }, 1500);
                console.log("runRight-F:", leftHead, leftEnd);
            } else {
                $(itemsArray[rightEnd - 1]).animate({left: "76px"}, 5000);
                rInterval = setInterval(function () {
                    if (flag < rightEnd) {
                        $(itemsArray[rightEnd - 2]).animate({left: "76px"}, 5000);
                        rightEnd--;
                        rightHead = rightEnd;
                    }
                }, 1500);
                console.log("runRight-R:", rightHead, rightEnd);
            }
        } else {
            $(itemsArray[end]).animate({left: "38px"}, 5000);//这一句有问题
            rInterval = setInterval(function () {
                if (flag < end + 1) {
                    $(itemsArray[end - 1]).animate({left: "38px"}, 5000);
                    end--;
                    head = end + 1;
                    console.log("head:",head,"end:",end);
                }
            }, 1500);
        }
        flag = index;

    }

    var runLeft = function () {
        clearInterval(rInterval);
        clearInterval(lInterval);
        left();
    }

    var runRight = function () {
        clearInterval(lInterval);
        clearInterval(rInterval);
        right();
    }

    var runStop = function () {
        $(".items").stop();
        clearInterval(lInterval);
        clearInterval(rInterval);
    }
</script>
</body>
</html>